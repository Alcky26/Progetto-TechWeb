CREATE DATABASE Pizzeria;

CREATE TABLE UTENTE (
	email VARCHAR NOT NULL,
	password VARCHAR NOT NULL,
	punti INT DEFAULT 0 NOT NULL,
	PRIMARY KEY (email)
);

CREATE TABLE BONUS (
	codiceBonus INT NOT NULL,
	dataScadenza TIMESTAMP NOT NULL,
	valore INT NOT NULL,
	dataRiscatto TIMESTAMP,
	PRIMARY KEY (codiceBonus)
);

CREATE TABLE POSSESSO_BONUS (
	codiceBonus INT NOT NULL,
	email VARCHAR NOT NULL,
	PRIMARY KEY (codiceBonus,email),
	FOREIGN KEY (codiceBonus) REFERENCES BONUS (codiceBonus),
	FOREIGN KEY (email) REFERENCES UTENTE (email)
);

CREATE TABLE RECENSIONE (
	descrizione VARCHAR NOT NULL,
	voto INT NOT NULL,
    dataOra TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    email VARCHAR NOT NULL, 
	PRIMARY KEY (dataOra,email),
	FOREIGN KEY (email) REFERENCES UTENTE (email)
);

CREATE TABLE TAVOLO (
	numero INT NOT NULL,
	posti INT NOT NULL,
	PRIMARY KEY (numero)
);

CREATE TABLE PRENOTAZIONE (
	persone INT NOT NULL,
	dataOra TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    numero INT NOT NULL,
    email VARCHAR NOT NULL, 
	PRIMARY KEY (numero,email),
	FOREIGN KEY (email) REFERENCES UTENTE (email)
    FOREIGN KEY (numero) REFERENCES TAVOLO (numero)
);

CREATE TABLE ORDINAZIONE (
	dataOra TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
	email VARCHAR NOT NULL,
	PRIMARY KEY (dataOra,email),
	FOREIGN KEY (email) REFERENCES UTENTE (email)
);

CREATE TABLE ELEMENTO_LISTINO (
	nome VARCHAR NOT NULL,
	prezzo DOUBLE NOT NULL,
    descrizione VARCHAR NOT NULL,???????????????????????????????????????
	PRIMARY KEY (nome)
);

CREATE TABLE ACQUISTO (
	quantita INT NOT NULL,
	nome VARCHAR NOT NULL,
    dataOra TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
	email VARCHAR NOT NULL,
	PRIMARY KEY (nome,dataOra,email),
	FOREIGN KEY (dataOra,email) REFERENCES ORDINAZIONE (dataOra,email)
    FOREIGN KEY (nome) REFERENCES ELEMENTO_LISTINO (nome)
);

CREATE TABLE PIZZA (
	nome VARCHAR NOT NULL,
	PRIMARY KEY (nome),
    FOREIGN KEY (nome) REFERENCES ELEMENTO_LISTINO (nome)
);

CREATE TABLE DOLCE (
	nome VARCHAR NOT NULL,
	PRIMARY KEY (nome),
    FOREIGN KEY (nome) REFERENCES ELEMENTO_LISTINO (nome)
);

CREATE TABLE BEVANDA (
	nome VARCHAR NOT NULL,
    gradiAlcolici INT NOT NULL,
	PRIMARY KEY (nome),
    FOREIGN KEY (nome) REFERENCES ELEMENTO_LISTINO (nome)
);

CREATE TABLE INGREDIENTE (
	nome VARCHAR NOT NULL,
	allergene BOOL DEFAULT false NOT NULL,
	PRIMARY KEY (nome)
);

CREATE TABLE COMPOSIZIONE (
	nome_ingr VARCHAR NOT NULL,
    nome VARCHAR NOT NULL,
	PRIMARY KEY (nomem,nome_ingr),
    FOREIGN KEY (nome) REFERENCES ELEMENTO_LISTINO (nome),
    FOREIGN KEY (nome_ingr) REFERENCES INGREDIENTE (nome)
);
